
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>
    
  iOS 开发模块知识 - ACEfish-Blog
  

  </title>
  <meta name="author" content="">
  <meta name="description" content="学习记录">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href="asset/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="atom.xml" rel="alternate" title="ACEfish-Blog" type="application/atom+xml">
  <script src="asset/js/modernizr-2.0.js"></script>
  <script src="asset/js/jquery.min.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/solarized_light.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>

  <style type="text/css">
  .cat-children-p{ padding: 6px 0px;}
  .hljs{background: none;}
  </style>
  <script type="text/javascript">
  var isAddSildbar = true;
  </script>
  <script src="asset/js/octopress.js" type="text/javascript"></script>
</head>
<script type="text/javascript">
//链接新开窗口
function addBlankTargetForLinks () {
  $('a[href^="http"]').each(function(){
      $(this).attr('target', '_blank');
  });
}
$(document).ready(function(event) {
  addBlankTargetForLinks();
});
</script>
<body   >
  <header role="banner"><hgroup>
  <h1><a href="index.html">ACEfish-Blog</a></h1>
  
    <h2>学习记录</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:acefish.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">

  <li id=""><a target="_self" href="index.html">首页</a></li>

  <li id=""><a target="_self" href="archives.html">归档</a></li>

</ul>

</nav>
  <div id="main">
    <div id="content"> 
<div class="blog-index">

	<article>
		 <header>
		  	<h1 class="entry-title"><a href="15697458035343.html">Node Containers</a></h1>
			<p class="meta"><time datetime="2019-09-29T16:30:03+08:00" 
			pubdate data-updated="true">2019/9/29</time></p>
		 </header>
	  	<div class="entry-content">
		  	
		  	<h2 id="toc_0">ASViewController</h2>

<p><code>ASViewController</code>是<code>UIViewController</code>的子类，添加了一些有用的功能来承载<code>ASDisplayNode</code>层次结构<br/>
可以使用<code>ASViewController</code>代替任何UIViewControlller</p>

<p>使用<code>ASViewController</code>的好处:</p>

<ol>
<li>保存内存。</li>
<li>ASVisibility</li>
</ol>

<h3 id="toc_1">使用</h3>

<p><code>UIViewController</code>提供了自己的View。<code>ASViewController</code>在初始化时  通过<code>initWithNode</code>分配了要管理的节点</p>

<pre><code class="language-objectivec">//例如 修改视图控制器的视图的根node 为 table node

- (instancetype)init
{
  _tableNode = [[ASTableNode alloc] initWithStyle:UITableViewStylePlain];
  self = [super initWithNode:_tableNode];
  
  if (self) {
    _tableNode.dataSource = self;
    _tableNode.delegate = self;
  }
  
  return self;
}
</code></pre>

<h2 id="toc_2">ASTableNode</h2>

<p>相当于<code>UITableView</code> 并且可以用来代替任何<code>UITableView</code></p>

<pre><code class="language-objectivec">- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath

//替换方法
- (ASCellNode *)tableNode:(ASTableNode *)tableNode nodeForRowAtIndexPath:(NSIndexPath *)indexPath
//或者
- (ASCellNodeBlock)tableNode:(ASTableNode *)tableNode nodeBlockForRowAtIndexPath:(NSIndexPath *)indexPath
</code></pre>

<blockquote>
<p>建议使用 nodeblock版本，以便table node可以同时准备和display。这意味着所有的<code>subnode</code>初始化方法都会在后台运行，请确保线程安全。</p>
</blockquote>

<p><code>ASCellNodeBlock</code>是创建<code>ASCellNode</code>的block，能够在后台线程运行。</p>

<blockquote>
<p>注意</p>

<p><code>ASCellNodes</code>被<code>ASTableNode、ASCollectionNode、ASPagerNode</code>使用</p>

<p>这些方法均不需要重用机制(只会执行一次，与UIKIt不同，当行要显示时不会调用这些方法)</p>
</blockquote>

<h3 id="toc_3">node block的线程安全</h3>

<p>node blocks必须是线程安全的。一方面是确保在node block外访问数据模型。因此，不太需要会在block内部访问indexPath</p>

<pre><code class="language-objectivec">- (ASCellNodeBlock)tableNode:(ASTableNode *)tableNode nodeBlockForRowAtIndexPath:(NSIndexPath *)indexPath
{
    PhotoModel *photoModel = [_photoFeed objectAtIndex:indexPath.row];
    
    // this may be executed on a background thread - it is important to make sure it is thread safe
    ASCellNode *(^cellNodeBlock)() = ^ASCellNode *() {
        PhotoCellNode *cellNode = [[PhotoCellNode alloc] initWithPhoto:photoModel];
        cellNode.delegate = self;
        return cellNode;
    };
    
    return cellNodeBlock;
}
</code></pre>

<h3 id="toc_4">ASTableView的访问</h3>

<p><code>ASTableView</code>是<code>UITalbeView</code>的子类，在<code>ASTalbeNode</code>内部进行使用，可以在<code>viewDidLoad</code>或<code>didLoad</code>方法找中通过<code>.view</code>属性访问节点的<code>view</code>或者<code>layer</code>属性</p>

<p>例如，可以再<code>ViewDidLoad</code>方法中 访问呢表节点的视图完成对表格的分隔符样式设置</p>

<pre><code class="language-objectivec">- (void)viewDidLoad
{
  [super viewDidLoad];
  
  _tableNode.view.allowsSelection = NO;
  _tableNode.view.separatorStyle = UITableViewCellSeparatorStyleNone;
  _tableNode.view.leadingScreensForBatching = 3.0;  // default is 2.0
}
</code></pre>

<h3 id="toc_5">行高</h3>

<p>需要注意的是： ASTableNode不提供和<code>UITableView</code>的<code>tableView:heightForRowAtIndexPath</code>等效功能<br/>
这是因为node 会根据提供的约束确定其自身的高度，因此不再需要编写代码在视图控制器中确定此信息<br/>
node通过<code>layoutSpecThatFits</code>方法 返回的<code>layoutSpec</code>定义其高度。所有给定了限制size的node都可以计算其目标size</p>

<p>默认情况，<code>ASTableNode</code>给其cell提供的大小范围约束，其中最小宽度为tablenode的宽度，最小高度为0.最大宽度为tablenode的宽度，最大高度为<code>FLT_MAX</code>，就是说table的cell宽度是固定的为整个table的宽度，但是其高度时灵活的，可以自动调整大小</p>

<p>如果在<code>ASCellNode</code>上调用<code>-setNeddsLayout</code> 将自动执行一遍布局，如果总体所需大小已经更改，通知table 将会进行更新</p>

<blockquote>
<p>注意</p>

<p>这些规则和UIKit不同，在UIKit中必须调用reload row/item。这样就节省了大量代码</p>
</blockquote>

<h2 id="toc_6">ASCollectionNode</h2>

<p>ASCollectionNode 等效于 UICollectionView 可以在任何情况下替代<code>UICollectionView</code></p>

<pre><code class="language-objectivec">- (UICollectionViewCell *)collectionView:(UICollectionView *)collectionView cellForItemAtIndexPath:(NSIndexPath *)indexPath;
//替换为
- (ASCellNode *)collectionNode:(ASCollectionNode *)collectionNode nodeForItemAtIndexPath:(NSIndexPath *)indexPath
//或
- (ASCellNodeBlock)collectionNode:(ASCollectionNode *)collectionNode nodeBlockForItemAtIndexPath:(NSIndexPath *)indexPath
</code></pre>

<p>推荐使用node block </p>

<h3 id="toc_7">cell 大小和布局</h3>

<p>可以使用<code>ASCollectionNode</code>的<code>-constrainedSizeForItemAtIndexPath：</code>约束colletion node中使用的cell</p>

<h3 id="toc_8">UICollectionViewCell的互通性</h3>

<p><code>ASCollectionNode</code>支持<code>UICollectionViewCells</code>和<code>ASCellNodes</code>一起使用</p>

<p>注意：即使混合在统一<code>ASCollectionNode</code>中，这些<code>UIKit</code>组件也不会有<code>ASCellNode</code>的性能优势</p>

<h2 id="toc_9">ASPageNode</h2>

<p><code>ASPageNode</code>是<code>ASCollectionView</code>的子类，只是内部采用了特殊的<code>UIColelctionViewLayout</code></p>

<p><code>ASPageNode</code>可以创建出类似<code>UIPageViewController</code>创建的页面UI。支持在轮换期间停留在正确的页面。不支持循环滚动</p>

<pre><code class="language-objectivec">- (NSInteger)numberOfPagesInPagerNode:(ASPagerNode *)pagerNode
//和
- (ASCellNode *)pagerNode:(ASPagerNode *)pagerNode nodeAtIndex:(NSInteger)index
//或者
- (ASCellNodeBlock)pagerNode:(ASPagerNode *)pagerNode nodeBlockAtIndex:(NSInteger)index`
</code></pre>

<h3 id="toc_10">使用ASViewController来获得最佳性能</h3>

<p>一种特别有用的模式就是 返回 使用现有<code>UIViewController</code>或者<code>ASViewController</code>初始化的ASCellNode。当然，为了获得最佳性能请使用<code>ASViewController</code></p>

<pre><code class="language-objectivec">- (ASCellNode *)pagerNode:(ASPagerNode *)pagerNode nodeAtIndex:(NSInteger)index
{
    NSArray *animals = self.animals[index];
    
    ASCellNode *node = [[ASCellNode alloc] initWithViewControllerBlock:^{
        return [[AnimalTableNodeController alloc] initWithAnimals:animals];;
    } didLoadBlock:nil];
    
    node.style.preferredSize = pagerNode.bounds.size;
    
    return node;
}
</code></pre>

<p>在这个例子中，该节点使用<code>initWithViewControllerBlock：</code>方法构造。通常时必须采用这种方法，以便执行正确的布局</p>

<h3 id="toc_11">使用ASPagerNode作为ASViewController的root node</h3>

<p><a href="https://texturegroup.org/docs/containers-aspagernode.html">log message</a></p>


		</div>

		

	</article>
  
	<div class="pagination">
	 <a class="prev" href="iOS 开发模块知识_6.html">&larr; Older</a> 
<a href="archives.html">Blog Archives</a>
	 <a class="next" href="iOS 开发模块知识_4.html">Newer &rarr;</a>  
	    
	</div>
</div>
 <aside class="sidebar"> 

	<section>
	  <h1>Categories</h1>
	  <ul id="recent_posts">
	  
	      <li class="post">
	        <a href="iOS%20%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9D%97%E7%9F%A5%E8%AF%86.html"><strong>iOS 开发模块知识&nbsp;(188)</strong></a>
	         <p class="cat-children-p"> 
	        
	        	<a href="%E7%BD%91%E7%BB%9C.html">网络&nbsp;(2)</a>&nbsp;&nbsp;
	        
	        	<a href="iOS%E7%BC%96%E8%AF%91.html">iOS编译&nbsp;(20)</a>&nbsp;&nbsp;
	        
	        	<a href="%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86&Block.html">内存管理&Block&nbsp;(18)</a>&nbsp;&nbsp;
	        
	        	<a href="RunTime.html">runtime&nbsp;(11)</a>&nbsp;&nbsp;
	        
	        	<a href="Concurrent-Programming.html">多线程&nbsp;(19)</a>&nbsp;&nbsp;
	        
	        	<a href="GPU&&%E6%B8%B2%E6%9F%93.html">GPU&&渲染&nbsp;(3)</a>&nbsp;&nbsp;
	        
	        	<a href="%E6%9E%B6%E6%9E%84%E5%AD%A6%E4%B9%A0.html">架构学习&nbsp;(8)</a>&nbsp;&nbsp;
	        
	        	<a href="%E7%AC%AC%E4%B8%89%E6%96%B9%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0.html">第三方项目学习&nbsp;(34)</a>&nbsp;&nbsp;
	        
	        	<a href="%E9%A1%B9%E7%9B%AE%E7%9B%91%E6%8E%A7.html">项目监控&nbsp;(10)</a>&nbsp;&nbsp;
	        
	        	<a href="%E6%B5%8B%E8%AF%95.html">调试&&测试&nbsp;(5)</a>&nbsp;&nbsp;
	        
	        	<a href="Cocoapods.html">Cocoapods&nbsp;(4)</a>&nbsp;&nbsp;
	        
	        	<a href="%E6%A8%A1%E5%9D%97%E5%8C%96%E7%9F%A5%E8%AF%86%E5%AD%A6%E4%B9%A0.html">模块化知识学习&nbsp;(26)</a>&nbsp;&nbsp;
	        
	        	<a href="Instrument%E5%AD%A6%E4%B9%A0.html">Instrument学习&nbsp;(1)</a>&nbsp;&nbsp;
	        
	        	<a href="%E7%9F%A5%E8%AF%86%E7%82%B9.html">知识点&nbsp;(10)</a>&nbsp;&nbsp;
	        
	        	<a href="%E8%A1%A5%E5%85%85-1.html">补充&nbsp;(9)</a>&nbsp;&nbsp;
	        
	        	<a href="%E9%9D%A2%E8%AF%95.html">面试&nbsp;(8)</a>&nbsp;&nbsp;
	        
	         </p> 
	      </li>
	  
	      <li class="post">
	        <a href="Swift.html"><strong>Swift初学笔记&nbsp;(28)</strong></a>
	         <p class="cat-children-p"> 
	        
	        	<a href="Swift-BaseLearning.html">Swift基础知识&nbsp;(28)</a>&nbsp;&nbsp;
	        
	         </p> 
	      </li>
	  
	      <li class="post">
	        <a href="Computer-programming.html"><strong>计算机编程&nbsp;(2)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="iOSDevelop.html"><strong>iOSDevelop&nbsp;(27)</strong></a>
	         <p class="cat-children-p"> 
	        
	        	<a href="iOS%20%E5%B0%8F%E7%9F%A5%E8%AF%86.html">iOS 小知识&nbsp;(14)</a>&nbsp;&nbsp;
	        
	        	<a href="iOS%E5%BC%80%E5%8F%91%E7%9F%A5%E8%AF%86.html">iOS开发知识&nbsp;(12)</a>&nbsp;&nbsp;
	        
	         </p> 
	      </li>
	  
	      <li class="post">
	        <a href="JavaScript%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html"><strong>JavaScript学习笔记&nbsp;(41)</strong></a>
	         <p class="cat-children-p"> 
	        
	        	<a href="%E5%9F%BA%E7%A1%80.html">基础&nbsp;(11)</a>&nbsp;&nbsp;
	        
	        	<a href="%E7%9F%A5%E8%AF%86%E6%99%AE%E5%8F%8A.html">知识普及&nbsp;(1)</a>&nbsp;&nbsp;
	        
	        	<a href="Flex.html">Flex&nbsp;(2)</a>&nbsp;&nbsp;
	        
	        	<a href="ES6.html">ES6&nbsp;(17)</a>&nbsp;&nbsp;
	        
	        	<a href="React.html">React&nbsp;(10)</a>&nbsp;&nbsp;
	        
	         </p> 
	      </li>
	  
	      <li class="post">
	        <a href="React-Native.html"><strong>React-Native&nbsp;(6)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="Python.html"><strong>Python&nbsp;(14)</strong></a>
	        
	        
	        
	      </li>
	  
	      <li class="post">
	        <a href="%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0.html"><strong>算法学习&nbsp;(2)</strong></a>
	         <p class="cat-children-p"> 
	        
	        	<a href="%E7%AE%97%E6%B3%95%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.html">算法读书笔记&nbsp;(2)</a>&nbsp;&nbsp;
	        
	         </p> 
	      </li>
	   
	  </ul>
	</section>
	<section>
	  <h1>Recent Posts</h1>
	  <ul id="recent_posts">
	  
	      
		      <li class="post">
		        <a href="15710288132412.html">Collections and asynchronous updates</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="15710248960458.html">Layout Specs</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="15707800044047.html">Node Lifecycle</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="15707737201639.html">线程</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="15698393226216.html">Nodes</a>
		      </li>
	     
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	  
	      
	   
	  </ul>
	</section>
	
</aside> </div></div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 -  -
  <span class="credit">Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; Theme by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>

  
    




</body>
</html>